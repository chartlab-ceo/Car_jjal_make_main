<html lang="en">
<head>
    <!-- meta íƒœê·¸ - ë¬¸ì„œì˜ ë¬¸ìì—´ ì¸ì½”ë”©ë“± ë‹¤ì–‘í•œ ì •ë³´ ì œê³µ -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìë™ì°¨ê°€ë¼ì‚¬ëŒ€!</title>    
    
    <!-- stylesheetì—°ê²° -->
    <style>
      body {
        text-align: center;
    }

    .main-card button {
        position: relative;
        left: -45px;
        bottom : 15px;
    }

    .favorites {
        list-style: none;
        /* border: 2px dotted; */
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap : 15px;
    }

    .favorites img {
        width:  150px;
    }    
    
    /* ulíƒœê·¸ì˜ ë¸”ë¦¿ì—†ì• ê¸° ë“¤ì—¬ì“°ê¸° ì•ˆí•˜ê¸° */
    ul {
    list-style:circle;
    padding-left:0px;
    }
    </style>

</head>

<body>
    <div id = "app"> </div>

    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>    
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>  
    <script type = "text/babel">

        //JSONí˜•ì‹ì˜ ë°ì´í„° ì €ì¥/ë¡œë”©
        const jsonLocalStorage = {
            setItem: (key, value) => {
            localStorage.setItem(key, JSON.stringify(value));
            },
            getItem: (key) => {
            return JSON.parse(localStorage.getItem(key));
            },
        };

        const fetchCat = async (text) => {
            const OPEN_API_DOMAIN = "https://cataas.com";
            const response = await fetch(`${OPEN_API_DOMAIN}/cat/says/${text}?json=true`);
            const responseJson = await response.json();
            return `${OPEN_API_DOMAIN}/${responseJson.url}`;
        };

        const CAR1 = "http://img.danawa.com/cms/img/2014/06/13/1402626434_thumb.jpg";
        const CAR2 = "https://c.wallhere.com/photos/85/46/Tesla_Motors_Tesla_Model_S_car-56926.jpg!d";
        const CAR3 = "https://img.hankyung.com/photo/202104/01.25994984.1.jpg";
        const CAR4 = "https://t1.daumcdn.net/cfile/tistory/9983F83A5B9F450528";

        //console.log("ë¶€ë¦‰");
        function CarItem(props) 
        {
            return (
            <li>
                <img 
                src = {props.img} 
                style = {{ width : "150px"}}
                />
            </li>
            );
        }

        function Faverites({faverites}) 
        {
            if(faverites.length === 0)
            {
                return <div> ì‚¬ì§„ ìœ„ í•˜íŠ¸ë¥¼ ëˆŒëŸ¬ ì‚¬ì§„ì„ ì €ì¥í•´ë´ìš”~</div>
            }

            // const cars = [CAR1,CAR2,CAR3,CAR4];
            // //ì£¼ì˜: react ë¬¸ë²•ì—ì„œ classëŠ” classNameìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤
            // //ì•„ë˜ ìƒ˜í”Œ - Array.map
            // return (
            //     <ul className = "favorites">
            //     { cars.map((car) => ( <CarItem img={car} key={car}/>))}
            //     </ul>
            // ); 

            //ì£¼ì˜: react ë¬¸ë²•ì—ì„œ classëŠ” classNameìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤
            //ì•„ë˜ ìƒ˜í”Œ - Array.map
            return (
                <ul className = "favorites">
                { faverites.map((car) => ( <CarItem img={car} key={car}/>))}
                </ul>
            ); 
        }   

        //í•¨ìˆ˜ì¸ë° functionìœ¼ë¡œ ëª…ì‹œí•˜ì§€ ì•Šì€ í™”ì‚´í‘œ í•¨ìˆ˜í˜•íƒœë¡œ 
        //ì£¼ì˜:ìƒˆë¡œìš´ ë¬¸ë²• propsë¥¼ ì“°ì§€ ì•Šê³  
        //ì‚¬ìš©ì imgë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë ¤ë©´ ({img})ë¼ê³  í•˜ê³  ì•„ë˜ì— ê·¸ëŒ€ë¡œ {img}ë¥¼ ì“°ë©´ ëœë‹¤
        const MainCard = ({img,onHeartClick,alreadyFaverites}) => {

            const heartIcon = alreadyFaverites ? "ğŸ’–" : "ğŸ¤";

            return (
                <div className = "main-card">
                <img 
                src = {img}
                alt = "ìë™ì°¨"
                width = "400"
                />
                <button onClick = {onHeartClick}>{heartIcon}</button>    
                </div>
            );
        } 

        const Title = (props) =>  {
            return (
                <h1> { props.children } </h1>
            );
        }

        const Form = ({updateMainCar}) => {           

            const includesHangul = (text) => /[ã„±-ã…|ã…-ã…£|ê°€-í£]/i.test(text);
            const [value,setValue]  = React.useState('');
            const [errorMsg,setErrorMsg]  = React.useState('');
            
            function handleInputChange(e)
            {
                const userValue = e.target.value;
                console.log(includesHangul(userValue));
                setErrorMsg('');
                if(includesHangul(userValue))
                {
                    setErrorMsg('í•œê¸€ì€ ì…ë ¥í• ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
                setValue(userValue.toUpperCase());
            }

            function handleFormSubmit(e) {
                e.preventDefault();

                setErrorMsg("");
                if(value == "")
                {
                    setErrorMsg('ë¹ˆ ê°’ìœ¼ë¡œ ë§Œë“¤ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }

                updateMainCar(value);
            }

            return (
                <form onSubmit = {handleFormSubmit}>
                <input type = "text" name = "name" placeholder="ì˜ì–´ ëŒ€ì‚¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                onChange= {handleInputChange}
                value = {value}
                />
                <button type = "submit"> ìƒì„± </button>
                <p style = {{color : 'red'}}> {errorMsg} </p>
            </form>
            );
        }

        //Component ì½”ë“œ ì¬ì‚¬ìš©(íƒœê·¸ ì²˜ëŸ¼ ì‚¬ìš©)     
         const App = () => {
            //ì•„ë˜ ë¬¸ë²• : ë§Œì¼ undefinded ì´ê±°ë‚˜  nullì´ë©´ 1ì„ ì‚¬ìš©í•´ë¼
            let jsonResultCounter = jsonLocalStorage.getItem("nowcounter") || 1;
            //LocalStorageì— ë¡œë”©(ì£¼ì˜:ì²˜ìŒì€ ë¹ˆì¹¸ì¼ìˆ˜ ìˆìœ¼ë‹ˆ ê¸°ë³¸ê°’ 1ì„ ì¤€ë‹¤)
            let [counter,setCounter] = React.useState(
                //JSonLocalStorageë¡œ ë¡œë”©
                Math.max(1,jsonResultCounter));
                // Math.max(1,Number(localStorage.getItem("counter"))));
            const [mainCarImg,setCarImg] = React.useState(CAR1);
            //const [faverites,setFaverites] = React.useState([CAR1,CAR2,CAR3]);
            //faveriteê°€ nullì´ë©´ []ì„ ì‚¬ìš©í•´ë¼
            //let jsonResultFaverites = jsonLocalStorage.getItem("faverites") || [CAR1,CAR2,CAR3];
            let jsonResultFaverites = jsonLocalStorage.getItem("faverites") || [];
            const [faverites,setFaverites] = React.useState(jsonResultFaverites);
                        
            //localStorage í•­ëª©ì˜ ì œê±° - localStorage.removeItem('counter');
            //localStorage í•­ëª©ì˜ ì „ì²´ ì œê±° - localStorage.clear();
            
            const alreadyFaverites = faverites.includes(mainCarImg);

            async function setInitCat() {
                
                const newCat = await fetchCat('First cat');
                console.log(newCat);
                setCarImg(newCat);
            }

            React.useEffect(() => {
                setInitCat();   
            },[]);

            //UIê°€ ë°”ë€”ë•Œë§ê³  ì›í•˜ëŠ” ì‹œì ì— í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ì‹¶ì„ë•Œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ê°€ useEffect

            //ì—¬ê¸°ì„œëŠ” counterê°€ ë³€ê²½ë ë•Œë§ˆë‹¤ í˜¸ì¶œ
            // React.useEffect(() => {
            //     console.log("hello");
            // },[counter]);

            //ë§Œì¼ ì•±ì´ ìµœì´ˆì— ìƒì„±ë ë•Œ í˜¸ì¶œí•˜ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ë¹ˆ ë°°ì—´ ì‚¬ìš©
            // React.useEffect(() => {
            //     console.log("hello");
            // },[]);
            
            async function updateMainCar(value) {

                const newCat = await fetchCat(value);

                /*//ì£¼ì˜: ì•„ë˜ formsubmitë¥¼ í•˜ë©´ ë¸Œë¼ìš°ì ¸ê°€ ê¸°ë³¸ì ìœ¼ë¡œ Refreshê°€ ë¨
                //console.log("í¼ ì „ì†¡ë¨"); 
                counter += 1;
                if(counter >= 4)  { counter = 1; }
                setCounter(counter);    

                if(mainCarImg == CAR1)            {      setCarImg(CAR2); }
                else if(mainCarImg == CAR2)       {      setCarImg(CAR3); }
                else if(mainCarImg == CAR3)       {      setCarImg(CAR4); }
                else if(mainCarImg == CAR4)             setCarImg(CAR1); */
                
                setCarImg(newCat);

                //LocalStorageì— ì €ì¥
                //localStorage.setItem("counter",counter);
                //JSonLocalStorageë¡œ ì €ì¥
                jsonLocalStorage.setItem("nowcounter",counter);
            }
            
            function handleHeartClick()
            {
                //console.log("í•˜íŠ¸ ëˆŒë €ìŒ");
                const nextFaverites = [...faverites,mainCarImg];
                setFaverites(nextFaverites);
                jsonLocalStorage.setItem("faverites",nextFaverites);
            }

            //handlerí•¨ìˆ˜ì´ë¦„ì„ propsìœ¼ë¡œ ë„˜ê¸¸ë•Œ ì•½ì† on~ìœ¼ë¡œ ì‹œì‘
            return (
                <div>
                    <Title> {counter}ë²ˆì§¸ ìë™ì°¨ ê°€ë¼ì‚¬ëŒ€</Title>
                    <Form updateMainCar = {updateMainCar}/>
                    <MainCard img = {mainCarImg} onHeartClick = {handleHeartClick}  alreadyFaverites = {alreadyFaverites} />
                    <Faverites faverites = {faverites}/> 
                </div>
            );
        }

        const ì—¬ê¸°ë‹¤ê·¸ë ¤ = document.querySelector("#app");
        //ReactDOM.render(app,ì—¬ê¸°ë‹¤ê·¸ë ¤);
        ReactDOM.render(<App />,ì—¬ê¸°ë‹¤ê·¸ë ¤);

    /*//1.ì¢‹ì•„ìš” ë²„íŠ¼ ì°¾ê¸°(.main-cart/button)
    const likeButton = document.querySelector(".main-card button")
    //2.ì¢‹ì•„ìš” ëˆŒë €ì„ë•Œ ì´ë²¤íŠ¸
    likeButton.addEventListener("click",function (){
        //3.í•˜íŠ¸ ìƒ‰ ë°”ê¾¸ê¸°
        likeButton.innerHTML = "ğŸ’–";

        //4.ê³ ì–‘ì´ ì‚¬ì§„ì„ ì¶”ê°€í• ê³³ ì°¾ê¸°
        const favorites = document.querySelector(".favorites");

        //5ìƒˆë¡œìš´ ê³ ì–‘ì´ ì‚¬ì§„ ë§Œë“¤ê¸°
        const newFavoriteImage = document.createElement("img");
        newFavoriteImage.src = "http://img.danawa.com/cms/img/2014/06/13/1402626434_thumb.jpg";

        //6.ê³ ì–‘ì´ ì‚¬ì§„ì„ ê°ì‹¸ëŠ” liíƒœê·¸ ë§Œë“¤ê¸°
        const li = document.createElement("li");
        //7.liíƒœê·¸ì— ê³ ì–‘ì´ ì‚¬ì§„ ë„£ê¸°
        li.appendChild(newFavoriteImage);
        //8.ë°©ê¸ˆ ë§Œë“  ìš”ì†Œ ë„£ê¸°
        favorites.appendChild(li);
    });*/
</script>



<!-- ë¸Œë¼ìš°ì €ëŠ” defer ì†ì„±ì´ ìˆëŠ” ìŠ¤í¬ë¦½íŠ¸(ì´í•˜ defer ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ì§€ì—° ìŠ¤í¬ë¦½íŠ¸)ë¥¼ 'ë°±ê·¸ë¼ìš´ë“œâ€™ì—ì„œ ë‹¤ìš´ë¡œë“œ í•©ë‹ˆë‹¤. 
    ë”°ë¼ì„œ ì§€ì—° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ëŠ” ë„ì¤‘ì—ë„ HTML íŒŒì‹±ì´ ë©ˆì¶”ì§€ ì•ŠìŠµë‹ˆë‹¤.
     ê·¸ë¦¬ê³  defer ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ì€ í˜ì´ì§€ êµ¬ì„±ì´ ëë‚  ë•Œê¹Œì§€ ì§€ì—° ë©ë‹ˆë‹¤. -->
<!-- <script defer src="../src/App.js"> </script> -->

</body>
</html>